# 网络安全小游戏

学习了之前的内容，你应该对网络基本架构有所了解。现在在此基础上，你需要建立一个带有登录功能的 HTTP 网站，比如输入姓名和密码，查询数学分析期中考试分数；我（张三）是一名可以查分的同学，也是一名“黑客”，现在希望通过各种黑客技术，查询到其他人（比如李四）的成绩。这个班里有非常多的人，除了我自己和李四，我不知道其他人的名字。不考虑重名。

我对你的网站提出攻击方案。在我给出攻击方案之后请你给出方案以升级网站的安全措施。

> 查询到其他人的成绩，可能包括：预先设立目标人物，比如李四，希望获取李四的成绩；或者能够获取不少于一个人的成绩，而这个（些）人是任意的。获取成绩时应包括姓名和成绩。

不要担心，助教本人对网络安全的了解也不多，有学习过前面的知识的同学应该都可以给出解答。

## 第 1 回合

> 背景知识：网站服务器发送到客户端的内容，可以使用 F12 查询文件内容。

黑客：如果我能用我自己的姓名密码登录网站，通过 F12 查询网站发来的信息，而这些信息包含了其他人的成绩信息，那么我就轻而易举地就可以获取李四的成绩。

<details>
<summary>解答</summary>
把所有成绩信息放在后台，对于每个前来查询的人只返回自己的成绩。

往年有很多助教自己建立成绩查询网站都会犯这个错误。
</details>

## 第 2 回合

黑客：现在我有能力在李四家的路由器上植入后门，或者说我开热点之后李四用我的热点查分，使得李四和服务器之间的所有数据包都能发一份到我这里。分析数据包就可以知道李四的成绩。

<details>
<summary>解答</summary>
HTTP 数据包对数据不加密，分析过往数据包就能发现李四的成绩。把网站修改为 HTTPS 可以增加网络攻击难度。
</details>

## 第 3 回合（略有超纲）

> 背景知识：你的网站使用数据库存储和查询数据，这个数据库包含一个表 marks，包含三列：name, password, mark，我讲几个数据库命令操作：
>
> 1. select * from marks where name='名字' and password='密码';
>
>    如：select * from marks where name='李四' and password='pwd_of_Li4';
>
>    这是网站查询数据的方式。名字和密码被替换为客户端查询页面发来的信息。这个语句输出一个表，包含所有 name 为“名字”、password 为“密码”的行，如果为返回空表则查询失败，否则只取第一行的成绩作为查询结果。
>
> 2. select * from marks where name='名字';
>
>    和上面的作用类似。
>
> 3. drop table marks;
>
>    删除数据库中的 marks 表。
>
> 4. 数据库操作以分号作为结尾，以 `--` 作为注释开头。

首先你先扮演一次黑客对网站发动安全攻击：

<details>
<summary>解答</summary>
在“名字”那一栏里填写：

```text
李四';--
```

原句成为：

```sql
select * from marks where name='李四';-- ' and password='密码';
```

即可查询到李四的成绩。

或者在“名字”填写：

```text
李四'; drop table marks;--
```

原句成为：

```sql
select * from marks where name='李四'; drop table marks;--' and password='密码';
```

即可在查询李四成绩之后删掉数据库的表。

</details>

然后作为网站管理员来阻挡这类攻击：

<details>
<summary>解答</summary>
执行数据库指令之前，检查输入数据是否合法。另外记得做好数据库内容备份。
</details>
